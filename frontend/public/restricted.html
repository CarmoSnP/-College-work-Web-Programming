<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Área Restrita</title>
    <link rel="stylesheet" href="../src/styles/restricted.css" />
    <link rel="stylesheet" href="../src/styles/not-logged-message.css" />
</head>

<body>
    <div class="login">
        <h2 id="bemvindo"></h2>
        <button id="logout">Sair</button>
    </div>

    <!-- Container para a mensagem de não logado -->
    <div id="notLoggedContainer" class="not-logged-container">
        <div class="not-logged-message">
            <h2>Você não está logado</h2>
            <p>Você será redirecionado para a página de login em <span id="countdown" class="countdown-number">5</span>
                segundos.</p>
            <div class="countdown">
                <span id="progressBar">
                    <span id="progressBarInner"></span>
                </span>
            </div>
            <a href="login.html" class="redirect-link">Clique aqui se não quiser esperar</a>
        </div>
    </div>

    <script>
        const nome = localStorage.getItem("userName");
        const sobrenome = localStorage.getItem("userLastName");

        if (nome && sobrenome) {
            document.getElementById("bemvindo").textContent =
                `Bem-vindo, ${nome} ${sobrenome}! Aqui estão suas informações restritas...`;
            // Esconde a mensagem de não logado
            document.getElementById('notLoggedContainer').style.display = 'none';
        } else {
            // Exibe a mensagem de não logado
            const notLoggedContainer = document.getElementById('notLoggedContainer');
            notLoggedContainer.style.display = 'flex';

            // Inicia o contador para redirecionamento
            let seconds = 5;
            const countdownElement = document.getElementById('countdown');
            const progressBarInner = document.getElementById('progressBarInner');

            // Atualiza a barra de progresso
            progressBarInner.style.width = '100%';

            const countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;

                // Atualiza a barra de progresso
                progressBarInner.style.width = (seconds * 20) + '%';

                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = "login.html";
                }
            }, 1000);
        }

        document.getElementById("logout").addEventListener("click", async function () {
            try {
                const response = await fetch("http://localhost:3000/auth/logout", {
                    method: "POST",
                    credentials: "include" // necessário para enviar cookies
                });

                if (response.ok) {
                    localStorage.removeItem("userName");
                    localStorage.removeItem("userLastName");
                    window.location.href = "login.html";
                } else {
                    alert("Erro ao fazer logout");
                }
            } catch (err) {
                console.error(err);
            }
        });
    </script>
</body>

</html>